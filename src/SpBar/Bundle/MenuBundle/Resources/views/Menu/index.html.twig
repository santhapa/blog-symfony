{% extends('SpBarBlogBundle::Backend/back_base.html.twig') %}

{% block body_container %}
    <link href="{{ asset('menu/css/style.css') }}" rel="stylesheet">

	<script src="{{ asset('menu/js/jquery-ui-1.10.3.custom.min.js') }}"></script>
    <script src="{{ asset('menu/js/jquery.ui.touch-punch.min.js') }}"></script>
    <script src="{{ asset('menu/js/jquery.mjs.nestedSortable.js') }}"></script>
    <script src="{{ asset('menu/js/menu.js') }}"></script>

    <script>
        var _BASE_URL = 'index.html';
        var current_group_id = 1;
    </script>

    <!-- Main content -->
	<section class="content">
		<div class="row">
			<div class="col-xs-12">
				<div class="box">
					<div class="box-header">
						<h3 class="box-title">
							<strong>Menu Manager</strong>
						</h3>
					</div><!-- /.box-header -->
					<div class="box-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                {% include 'SpBarMenuBundle:Menu:menu_content.html.twig' %}
                            </div>
                            <div class="col-xs-12 col-sm-3">
                                <div class="box collapsed-box">
                                    <div class="box-header">
                                        <h3 class="box-title">
                                            <strong>Categories</strong>
                                        </h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
                                        </div>
                                    </div><!-- /.box-header -->
                                    <div class="box-body">
                                        {# 
                                        <form id="form-add-category-menu" action="{{ path('sp_api_menu_new_category') }}" method="POST">
                                            {% for category in categorys %}
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" value="{{ category.slug }}" name="category_menu[]"> {{ category.name }}
                                                    </label>
                                                </div>
                                            {% endfor %}
                                            <div class="form-group">
                                                <button type="submit" id="add-category-menu" class="btn btn-info">Add To Menu</button>
                                            </div>
                                        </form> #}
                                        {% include "SpBarMenuBundle:Menu/Form:category.html.twig" with {'form': categoryForm} %}
                                    </div>
                                </div>

                                <div class="box collapsed-box">
                                    <div class="box-header">
                                        <h3 class="box-title">
                                            <strong>Pages</strong>
                                        </h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
                                        </div>
                                    </div><!-- /.box-header -->
                                    <div class="box-body">
                                        {# 
                                        <form id="form-add-page-menu" action="{{ path('sp_api_menu_new_page') }}" method="POST">
                                            {% for page in pages %}
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" value="{{ page.slug }}" name="page_menu[]"> {{ page.title }}
                                                    </label>
                                                </div>
                                            {% endfor %}
                                            <div class="form-group">
                                                <button type="submit" id="add-page-menu" class="btn btn-info">Add To Menu</button>
                                            </div>
                                        </form>
                                        #}
                                        {% include "SpBarMenuBundle:Menu/Form:page.html.twig" with {'form': pageForm} %}

                                    </div>
                                </div>  

                                <div class="box">
                                    <div class="box-header">
                                        <h3 class="box-title">
                                            <strong>Custom URL</strong>
                                        </h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div><!-- /.box-header -->
                                    <div class="box-body">
                                        <form action="{{ path('sp_api_menu_post_menus') }}" id="form-add-custom-menu" method="POST" name="form-add-custom-menu">
                                            <div class="form-group">
                                                {{ form_label(form.name) }}
                                                {{form_widget(form.name, {"attr" : {"class": "form-control custom-menu-name"}})}}
                                            </div>

                                            <div class="form-group">
                                                {{ form_label(form.url) }}
                                                {{form_widget(form.url, {"attr" : {"value" : "http://", "class": "form-control custom-menu-url"}})}}
                                            </div>
                                            <div class="form-group">
                                                <button type="submit" id="add-menu" class="btn btn-info">Add To Menu</button>
                                            </div>
                                        </form>
                                    </div>              
                                </div><!-- /.box -->
                                {# 
                                <div class="box">
                                    <div class="box-header">
                                        <h3 class="box-title">
                                            <strong>Preview</strong>
                                        </h3>
                                    </div><!-- /.box-header -->
                                    <div class="box-body">
                                        <input type="submit" name="serialize" id="serialize" value="Serialize" />
                                        <pre id="serializeOutput"></pre>

                                        <input type="submit" name="toArray" id="toArray" value="To array" />
                                        <pre id="toArrayOutput"></pre>

                                        <input type="submit" name="toHierarchy" id="toHierarchy" value="To hierarchy" />
                                        <pre id="toHierarchyOutput"></pre>
                                    </div>              
                                </div><!-- /.box -->
                                 #}
                            </div>
                        </div>
					</div>
				</div><!-- /.box -->
			</div><!-- /.col -->
		</div><!-- /.row -->
	</section><!-- /.content -->

    <script type="text/javascript">
        $(document).ready(function(){

            $('#serialize').click(function(){
                serialized = $('#easymm').nestedSortable('serialize');
                $('#serializeOutput').text(serialized+'\n\n');
            });

            $('#toHierarchy').click(function(e){
                console.log('hierarchy');
                hiered = $('#easymm').nestedSortable('toHierarchy', {startDepthCount: 0});
                $('#toHierarchyOutput').text(hiered+'\n\n');
                // console.log(hiered);
                hiered = dump(hiered);
                (typeof($('#toHierarchyOutput')[0].textContent) != 'undefined') ?
                $('#toHierarchyOutput')[0].textContent = hiered : $('#toHierarchyOutput')[0].innerText = hiered;
            });

            $('#toArray').click(function(e){
                console.log('array');
                arraied = $('#easymm').nestedSortable('toArray', {startDepthCount: 0});
                arraied = dump(arraied);
                // console.log(arraied);

                (typeof($('#toArrayOutput')[0].textContent) != 'undefined') ?
                $('#toArrayOutput')[0].textContent = arraied : $('#toArrayOutput')[0].innerText = arraied;
            });

        });
        function dump(arr,level) {
            var dumped_text = "";
            if(!level) level = 0;

            //The padding given at the beginning of the line.
            var level_padding = "";
            for(var j=0;j<level+1;j++) level_padding += "    ";

            if(typeof(arr) == 'object') { //Array/Hashes/Objects
                for(var item in arr) {
                    var value = arr[item];

                    if(typeof(value) == 'object') { //If it is an array,
                        dumped_text += level_padding + "'" + item + "' ...\n";
                        dumped_text += dump(value,level+1);
                    } else {
                        dumped_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
                    }
                }
            } else { //Strings/Chars/Numbers etc.
                dumped_text = "===>"+arr+"<===("+typeof(arr)+")";
            }
            return dumped_text;
        }
    </script>
{% endblock body_container %}
	